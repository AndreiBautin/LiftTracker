@page "/clear"
@using LiftTracker.Data
@using LiftTracker.UseCases
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using Microsoft.EntityFrameworkCore
@attribute [StreamRendering]
@rendermode InteractiveServer
@inject NavigationManager NavigationManager;
@inject IConfiguration Configuration;
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize];

<h2>Clear Macrocycle</h2>

<div class="row">
	<button class="btn-outline-light btn rounded-pill my-3" @onclick="OnClear">Clear MacroCycle</button>
</div>

@code {
	private void OnClear()
	{
		using var context = new LiftTrackerContextBuilder(Configuration).Build();
		if (context.Sets.Count() > 0)
		{
			context.Sets.ExecuteDelete();
			context.SessionExercises.ExecuteDelete();
			context.Sessions.ExecuteDelete();
			context.MicroCycles.ExecuteDelete();
			context.MesoCycles.ExecuteDelete();
			context.TrainingBlocks.ExecuteDelete();
			context.MacroCycles.ExecuteDelete();
			context.SaveChanges();
		}
		NavigationManager.NavigateTo("/", true);
	}
}